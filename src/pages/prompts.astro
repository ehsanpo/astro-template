---
import Layout from "../layouts/Layout.astro";
import PageHero from "../components/hero/PageHero.astro";
import { getPrompts } from "../utils/data";
import { PromptSidebar } from "../components/prompts/PromptSidebar";

const prompts = await getPrompts();

// Render all prompt contents
const renderedPrompts = await Promise.all(
	prompts.map(async (prompt) => {
		const { Content } = await prompt.content.render();
		return {
			...prompt,
			Content,
		};
	})
);
---

<Layout
	title="AI Prompts - Ehsan's Collection"
	description="A collection of AI prompts for various tasks including blog writing, resume reviews, cover letters, and more"
	imageAlt="Ehsan's AI Prompts Collection"
>
	<PageHero
		title="AI Prompts"
		subtitle="A collection of AI prompts for various tasks - copy and use with your favorite AI assistant"
	/>

	<div class="container mx-auto px-4 py-20">
		<div class="flex flex-col gap-8 lg:flex-row">
			<PromptSidebar
				prompts={prompts.map((p) => ({
					title: p.title,
					slug: p.slug,
					category: p.category,
					icon: p.icon,
				}))}
				client:load
			/>
			<main class="flex-1">
				{
					renderedPrompts.map((prompt, index) => (
						<div
							id={prompt.slug}
							class:list={["prompt-section mx-auto max-w-4xl", index === 0 ? "block" : "hidden"]}
							data-slug={prompt.slug}
						>
							{/* Header */}
							<div class="mb-8">
								<h1 class="mb-3 text-4xl font-bold text-gray-900 dark:text-white">
									{prompt.title}
								</h1>
								<p class="text-lg text-gray-600 dark:text-gray-400">{prompt.description}</p>

								{/* Tags */}
								{prompt.tags && prompt.tags.length > 0 && (
									<div class="mt-4 flex flex-wrap gap-2">
										{prompt.tags.map((tag) => (
											<span class="rounded-full bg-gray-100 px-3 py-1 text-sm text-gray-700 dark:bg-gray-800 dark:text-gray-300">
												#{tag}
											</span>
										))}
									</div>
								)}
							</div>

							{/* Prompt Content */}
							<div class="relative">
								<button
									class="copy-button bg-primary hover:bg-primary/90 absolute right-4 top-4 rounded-lg px-4 py-2 text-sm font-medium text-white transition-colors"
									data-slug={prompt.slug}
									title="Copy prompt to clipboard"
								>
									<svg
										class="mr-2 inline-block h-4 w-4"
										fill="none"
										stroke="currentColor"
										viewBox="0 0 24 24"
									>
										<path
											stroke-linecap="round"
											stroke-linejoin="round"
											stroke-width="2"
											d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"
										/>
									</svg>
									Copy
								</button>

								<div class="prose prose-lg max-w-none rounded-xl border border-gray-200 bg-white p-8 dark:prose-invert dark:border-gray-800 dark:bg-gray-900">
									<div class="prompt-content" data-slug={prompt.slug}>
										<prompt.Content />
									</div>
								</div>
							</div>

							{/* Info box */}
							<div class="mt-8 rounded-lg border border-blue-200 bg-blue-50 p-4 dark:border-blue-800 dark:bg-blue-900/20">
								<div class="flex items-start">
									<svg
										class="mr-3 mt-0.5 h-5 w-5 text-blue-600 dark:text-blue-400"
										fill="currentColor"
										viewBox="0 0 20 20"
									>
										<path
											fill-rule="evenodd"
											d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
											clip-rule="evenodd"
										/>
									</svg>
									<div class="flex-1">
										<h3 class="text-sm font-medium text-blue-800 dark:text-blue-300">
											How to use this prompt
										</h3>
										<p class="mt-1 text-sm text-blue-700 dark:text-blue-400">
											Copy the prompt above and paste it into your favorite AI assistant (ChatGPT,
											Claude, etc.). You can customize it based on your specific needs.
										</p>
									</div>
								</div>
							</div>
						</div>
					))
				}
			</main>
		</div>
	</div>
</Layout>

<script>
	// Handle navigation between prompts
	function initPromptNavigation() {
		const sections = document.querySelectorAll(".prompt-section");
		const links = document.querySelectorAll('aside a[href^="#"]');

		links.forEach((link) => {
			link.addEventListener("click", (e) => {
				e.preventDefault();
				const targetSlug = (link as HTMLAnchorElement).href.split("#")[1];

				// Hide all sections
				sections.forEach((section) => {
					section.classList.add("hidden");
				});

				// Show target section
				const targetSection = document.querySelector(`[data-slug="${targetSlug}"]`);
				if (targetSection) {
					targetSection.classList.remove("hidden");

					// Scroll with offset for header
					const headerOffset = 120; // Adjust this value based on your header height
					const elementPosition = targetSection.getBoundingClientRect().top;
					const offsetPosition = elementPosition + window.pageYOffset - headerOffset;

					window.scrollTo({
						top: offsetPosition,
						behavior: "smooth",
					});
				}
			});
		});

		// Handle copy buttons
		const copyButtons = document.querySelectorAll(".copy-button");
		copyButtons.forEach((button) => {
			button.addEventListener("click", async () => {
				const slug = button.getAttribute("data-slug");
				const contentElement = document.querySelector(`.prompt-content[data-slug="${slug}"]`);

				if (contentElement) {
					try {
						await navigator.clipboard.writeText(contentElement.textContent || "");

						// Visual feedback
						const originalText = button.innerHTML;
						button.innerHTML = `
							<svg class="mr-2 inline-block h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
							</svg>
							Copied!
						`;

						setTimeout(() => {
							button.innerHTML = originalText;
						}, 2000);
					} catch (err) {
						console.error("Failed to copy:", err);
					}
				}
			});
		});
	}

	// Initialize on page load
	initPromptNavigation();

	// Re-initialize on navigation (for View Transitions if enabled)
	document.addEventListener("astro:page-load", initPromptNavigation);
</script>

<style>
	@keyframes slide-down {
		from {
			transform: translateY(-100%);
			opacity: 0;
		}
		to {
			transform: translateY(0);
			opacity: 1;
		}
	}

	.animate-slide-down {
		animation: slide-down 0.3s ease-out;
	}
</style>
